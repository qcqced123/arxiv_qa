# ü§î QA System for Arxiv Paper

This project is a QA system for arxiv papers. The system is designed to answer questions based on the content of the paper. The system is built using the [RAG](https://arxiv.org/abs/2104.08691) architecture. The modules of the system are as follows:

- **üî≠ Retriever: Query/Document Encoder**
  - **Model: e5-large-v2 ([link](https://huggingface.co/intfloat/e5-large-v2))**
  - **Fine-Tune:** 
    - **InfoNCE Loss ([link](https://arxiv.org/pdf/2212.03533))**
    - **QLoRA (model: NF4, LoRA: bfloat16) ([link](https://arxiv.org/pdf/2305.14314))**
  
  - **Dataset: question-document pair dataset (custom made, questions are generated by LLM)**
  - **Inference:**
    - **de-quantize the NF4 weight to torch.bfloat16**
    - **merge the model weights (torch.bfloat16) and LoRA weights (torch.bfloat16)**
    - **float precision: bfloat 16**

  => [you can check the fine-tune result in the following link here](https://wandb.ai/qcqced/ArxivMetricLearning?nw=nwuserqcqced)

- **üß† Generator**
  - **Model: microsoft/Phi-3.5-mini-instruct ([link)](https://huggingface.co/microsoft/Phi-3.5-mini-instruct))**
  
  - **Quantization**: 
    - **AWQ (Activation-Aware Quantization) from MiT ([link](https://arxiv.org/pdf/2306.00978))**
    - **4 bit precision**
    - **weight-only**
  
  - **inference backend:**
    - **vllm from UC Berkeley for using Paged Attention, In-Flight Batching**
- **‚úÇÔ∏è Text Chunk Strategy**
  - **Library: unstructured, langchain (explain)**
  
  - **Strategy:**
    - **split the document into each elements by using unstructured**
      - **Title, NarrativeText, Formula, Table, FigureCaption**
    
    - **apply the process of each elements:**
      - **Title & NarrativeText: add the title and narrative text as a single chunk with appropriate seperator (it will be re-split into multiple chunks in the Recursive Chunking Strategy in langchain)**
      - **Formula: convert python math expression string to latex style code**
      - **Table: convert table to html table code**
      - **FigureCaption: add to Table object as a caption tag**
      - **langchain.RecursiveSplitter: apply this method to body text(add Title and NarrativeText Elements)**

- **üóÇÔ∏è Document Embedding DB**
  - **DB: Elastic Search**
  - **Retrieve method: knn (ElasticSearch.knn_search)**
    - **distance metric: cosine similarity**
    - **dimension of hidden state: 1024**
    - **number of candidates: 5**

## üìö System Architecture
![Image Description](assets/images/rag_pipeline.drawio.png)